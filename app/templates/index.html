{% extends 'base.html' %}
  {% block head_extra %}
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "WebPage",
    "name": "Home",
    "url": "{{ canonical_url }}",
    "description": "{{ description or DEFAULT_DESCRIPTION }}"
  }
  </script>
  {% endblock %}

{% block scripts %}
  <script defer src="{{ url_for('static', filename='js/home.js') }}?v={{ STATIC_VERSION }}"></script>
{% endblock %}
  {% block content %}
  <section class="hero">
    <div class="hero-content">
      <div class="pill"><span class="dot"></span> Live Demo</div>
      <h1>Token Arena<br><span class="gradient-text">Battle-tested Market Intel</span></h1>
      <p class="subtitle">Real-time leaderboards, holder analytics, RGB asset launchpad, and lightning-fast trading insights across the Bitcoin ecosystem.</p>
      <div id="tagline-rotator" class="tagline">Loading magic…</div>
      <div class="fun-controls"><button id="party-toggle" class="btn small" title="Toggle party mode">🎈 Party Mode</button></div>
      <div class="cta-row">
        <a href="/dashboard" class="btn btn-cta dashboard-btn"><span class="label">Open Dashboard</span> <span class="arrow" aria-hidden="true">→</span></a>
        <a href="/launchpad" class="btn btn-secondary">Launch RGB Asset</a>
        <a href="/#tokens" class="btn">Explore Tokens</a>
      </div>
      <div class="hero-stats">
        <div class="hero-stat"><span id="hero-tokens" class="value">—</span><span class="label">Tokens</span></div>
        <div class="hero-stat"><span id="hero-holders" class="value">—</span><span class="label">Holders</span></div>
        <div class="hero-stat"><span id="hero-volume" class="value">—</span><span class="label">24h Volume</span></div>
      </div>
    </div>
  </section>
  
  <!-- Live Home Ticker -->
  <section class="home-ticker" aria-label="Live movers">
    <div id="home-ticker" class="home-ticker-track"></div>
  </section>

<!-- Daily Quest -->
<section class="daily-quest" aria-labelledby="dq-title">
  <div class="section-header with-actions">
    <h2 id="dq-title">Daily Quest</h2>
    <p class="section-subtitle">Complete fun tasks and earn bragging rights</p>
    <div id="streak-pill" class="streak-pill">🔥 0-day streak</div>
  </div>
  <div id="daily-quest" class="dq-grid"></div>
</section>

  <!-- Weekly Battle -->
  <section class="weekly-battle" aria-labelledby="wb-title">
    <div class="section-header with-actions">
      <div>
        <h2 id="wb-title">Weekly Battle</h2>
        <p class="section-subtitle">Head-to-head faceoffs of the biggest tokens this week</p>
      </div>
      <button class="btn loot" id="loot-drop" title="Spawn confetti!">🎉 Loot Drop</button>
    </div>
    <div id="weekly-battle"></div>
  </section>

  <!-- Lucky Spin -->
  <section class="spin-section" aria-labelledby="spin-title">
    <div class="section-header with-actions">
      <div>
        <h2 id="spin-title">Lucky Spin</h2>
        <p class="section-subtitle">Feeling lucky? Spin to spotlight a random token</p>
      </div>
      <button id="spin-btn" class="btn">🎰 Spin</button>
    </div>
    <div id="spin-result" class="spin-result muted">Press Spin to pick a token…</div>
  </section>

  <!-- Featured Products -->
  <section class="products" id="products">
    <div class="section-header">
      <h2>Powerful Tools for Bitcoin Ecosystem</h2>
      <p class="section-subtitle">Everything you need to track, trade, and launch in the RGB ecosystem</p>
    </div>
    <div class="products-grid">
      <div class="product-card featured">
        <div class="product-icon">⚔️</div>
        <h3>Arena</h3>
        <p>Real-time token leaderboards with advanced metrics: returns, holders growth, market share delta, and composite scoring.</p>
        <a href="/arena" class="product-link">Explore Arena →</a>
      </div>
      <div class="product-card">
        <div class="product-icon">🚀</div>
        <h3>Launchpad</h3>
        <p>Mint new RGB assets via your RLN node and create custom BTC↔RGB vAMM pools with virtual liquidity.</p>
        <a href="/launchpad" class="product-link">Launch Asset →</a>
      </div>
      <div class="product-card">
        <div class="product-icon">💼</div>
        <h3>Dashboard</h3>
        <p>Manage your wallet: view BTC node balance, asset holdings, deposit/withdrawal history, and create invoices.</p>
        <a href="/dashboard" class="product-link">Open Dashboard →</a>
      </div>
    </div>
  </section>

  <!-- Key Features -->
  <section class="features" id="features">
    <div class="section-header">
      <h2>Built for the RGB Ecosystem</h2>
      <p class="section-subtitle">Professional-grade tools with enterprise reliability</p>
    </div>
    <div class="features-grid">
      <div class="feature-card">
        <div class="feature-icon">📊</div>
        <h3>Advanced Analytics</h3>
        <p>7-day Sharpe ratios, holders growth tracking, market share deltas, and composite scoring algorithms.</p>
      </div>
      <div class="feature-card">
        <div class="feature-icon">⚡</div>
        <h3>Lightning Integration</h3>
        <p>Native RGB Lightning Node integration for seamless BTC and RGB asset deposits and withdrawals.</p>
      </div>
      <div class="feature-card">
        <div class="feature-icon">🔄</div>
        <h3>vAMM Trading</h3>
        <p>Virtual automated market makers with customizable fees and virtual liquidity for new asset pairs.</p>
      </div>
      <div class="feature-card">
        <div class="feature-icon">🎯</div>
        <h3>Real-time Data</h3>
        <p>Live market data, instant sparklines, and sub-second updates across all metrics and leaderboards.</p>
      </div>
      <div class="feature-card">
        <div class="feature-icon">🏆</div>
        <h3>Competitions</h3>
        <p>Run trading competitions with custom scoring, leaderboards, and participant tracking.</p>
      </div>
      <div class="feature-card">
        <div class="feature-icon">🔐</div>
        <h3>Nostr Auth</h3>
        <p>Secure authentication via Nostr keys with session management and user profile support.</p>
      </div>
    </div>
  </section>

  <!-- Demo Controls -->
  <section class="demo-section" id="demo-presets">
    <div class="section-header">
      <h2>Try Demo Mode</h2>
      <p class="section-subtitle">Explore with realistic mock data - no setup required</p>
    </div>
    <div class="segmented" id="demo-presets-buttons" style="margin: 6px 0 10px;">
      <div class="btn" data-preset="calm-small">Calm · Small</div>
      <div class="btn active" data-preset="normal-medium">Normal · Medium</div>
      <div class="btn" data-preset="degen-large">Degen · Large</div>
    </div>
    <div class="muted" style="font-size:13px">💡 Presets automatically enable Demo Mode with different market conditions and dataset sizes.</div>
  </section>

  <section class="stats-grid" id="market-stats">
  <div class="stat-card">
    <div class="stat-label">Total Market Cap</div>
    <div id="stat-market-cap" class="stat-value">—</div>
  </div>
  <div class="stat-card">
    <div class="stat-label">24h Volume</div>
    <div id="stat-volume" class="stat-value">—</div>
  </div>
  <div class="stat-card">
    <div class="stat-label">Total Tokens</div>
    <div id="stat-tokens" class="stat-value">—</div>
  </div>
  <div class="stat-card">
    <div class="stat-label">Total Holders</div>
    <div id="stat-holders" class="stat-value">—</div>
  </div>
  <div class="stat-card">
    <div class="stat-label">Top Dominance</div>
    <div id="stat-dominance" class="stat-value">—</div>
  </div>
  </section>

<section class="battles" id="tokens">
  <h2>Leaderboard — Top Movers</h2>
  <div class="segmented" id="movers-metric" style="margin: 6px 0 10px;">
    <div class="btn active" data-metric="change_24h">24h</div>
    <div class="btn" data-metric="r7">7D</div>
    <div class="btn" data-metric="r7_sharpe">Sharpe 7D</div>
    <div class="btn" data-metric="holders_growth_pct_24h">Holders 24h</div>
    <div class="btn" data-metric="share_delta_7d">Share Δ 7D</div>
    <div class="btn" data-metric="turnover_pct">Turnover</div>
    <div class="btn" data-metric="composite">Composite</div>
  </div>
  <div id="top-movers" class="movers"></div>

  <div class="table-tools">
    <input id="tokens-filter" class="search-input small" type="search" placeholder="Filter tokens (symbol or name)…" autocomplete="off" />
    <input id="min-mcap" class="search-input small" type="number" inputmode="numeric" placeholder="Min Mcap (USD)" style="max-width: 160px;" />
    <input id="min-volume" class="search-input small" type="number" inputmode="numeric" placeholder="Min Vol 24h (USD)" style="max-width: 180px;" />
    <div class="tool-buttons">
      <button class="btn" id="export-csv">Export CSV</button>
    </div>
    <div class="segmented" id="table-metric" style="margin-left:auto;">
      <div class="btn active" data-metric="change_24h">24h</div>
      <div class="btn" data-metric="r7">7D</div>
      <div class="btn" data-metric="r7_sharpe">Sharpe 7D</div>
      <div class="btn" data-metric="holders_growth_pct_24h">Holders 24h</div>
      <div class="btn" data-metric="share_delta_7d">Share Δ 7D</div>
      <div class="btn" data-metric="turnover_pct">Turnover</div>
      <div class="btn" data-metric="composite">Composite</div>
    </div>
    <div class="segmented" id="spark-range">
      <div class="btn active" data-days="7">7D</div>
      <div class="btn" data-days="30">30D</div>
    </div>
  </div>

  <div class="table-wrapper">
    <table class="tokens-table" aria-label="Tokens">
      <thead>
        <tr>
          <th scope="col">#</th>
          <th scope="col" class="sortable" data-key="symbol">Token <span class="arrow">▼</span></th>
          <th scope="col" class="sortable" data-key="price_usd">Price <span class="arrow">▼</span></th>
          <th scope="col" id="spark-col-label">7d</th>
          <th scope="col" class="sortable" data-key="market_cap_usd">Market Cap <span class="arrow">▼</span></th>
          <th scope="col" class="sortable" data-key="holders_count">Holders <span class="arrow">▼</span></th>
          <th scope="col" class="sortable" data-metric="metric" id="metric-col-label">Metric <span class="arrow">▼</span></th>
          <th scope="col" class="sortable" data-key="change_24h">24h <span class="arrow">▼</span></th>
        </tr>
      </thead>
      <tbody id="tokens-tbody"></tbody>
    </table>
  </div>
  <div class="pagination-bar">
    <div class="rows-select">Rows:
      <select id="page-size">
        <option value="10">10</option>
        <option value="25">25</option>
        <option value="50">50</option>
      </select>
    </div>
    <div class="pagination" id="tokens-pagination"></div>
  </div>
</section>

<section class="charts" id="charts">
  <h2>Ecosystem Charts</h2>
  <div class="segmented" id="global-range" style="margin: 6px 0 12px;">
    <div class="btn" data-range="7d">7D</div>
    <div class="btn active" data-range="30d">30D</div>
    <div class="btn" data-range="90d">90D</div>
    <div class="btn" data-range="all">All</div>
  </div>
  <div class="charts-grid">
    <div class="chart-card">
      <h3>Number of Tokens Over Time</h3>
      <canvas id="globalTokensChart"></canvas>
    </div>
    <div class="chart-card">
      <h3>Number of Holders Over Time</h3>
      <canvas id="globalHoldersChart"></canvas>
    </div>
  </div>
</section>

<!-- Spotlights: Competitions & Sources -->
<section class="spotlights" aria-label="Spotlights">
  <div class="spotlights-grid">
    <div class="spot-panel">
      <h3>Competitions</h3>
      <div id="spotlight-competitions" class="spot-cards"></div>
    </div>
    <div class="spot-panel">
      <h3>Data Sources</h3>
      <div id="spotlight-sources" class="spot-cards"></div>
    </div>
  </div>
  <div class="muted small" style="margin-top:6px">Powered by community competitions and open data</div>
  </section>

<!-- Logos Bar -->
<section class="logos" aria-label="Partners and data sources">
  <div class="logos-row">
    <span class="logo">⚡ RLN</span>
    <span class="logo">LNFI</span>
    <span class="logo">Nostr</span>
    <span class="logo">Mempool</span>
    <span class="logo">RGB</span>
  </div>
  <div class="muted small" style="text-align:center;margin-top:6px">Ecosystem integrations powering Token Arena</div>
  </section>

<!-- Testimonials -->
<section class="testimonials" aria-labelledby="testimonials-title">
  <h2 id="testimonials-title" class="visually-hidden">Testimonials</h2>
  <div class="testimonials-grid">
    <div class="t-card">
      <p>“Arena gives me a fast pulse of the RGB market — I check it every day.”</p>
      <div class="who">Pro Trader</div>
    </div>
    <div class="t-card">
      <p>“The launchpad workflow is the smoothest way to issue and list new RGB assets.”</p>
      <div class="who">RGB Issuer</div>
    </div>
    <div class="t-card">
      <p>“Clean UI, powerful filters, and export — exactly what I need.”</p>
      <div class="who">Analyst</div>
    </div>
  </div>
</section>

<!-- What's New -->
<section class="whats-new-section" id="whats-new">
  <div class="section-header">
    <h2>What’s New</h2>
    <p class="section-subtitle">Latest updates and features</p>
  </div>
  <div id="whats-new-list" class="whats-new-grid"></div>
</section>

<!-- CTA Section -->
<section class="cta-section">
  <div class="cta-content">
    <h2>Ready to Battle?</h2>
    <p>Join the arena and start tracking the RGB ecosystem with professional-grade tools.</p>
    <div class="cta-buttons">
      <a href="/dashboard" class="btn btn-cta">Get Started</a>
      <a href="/arena" class="btn btn-outline">View Leaderboard</a>
    </div>
  </div>
</section>

<style>
  .visually-hidden { position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px; overflow: hidden; clip: rect(0, 0, 0, 0); border: 0; }
  .logos { margin: 28px 0; }
  .logos-row { display:flex; flex-wrap:wrap; gap:16px; justify-content:center; align-items:center; }
  .logos-row .logo { opacity:0.9; border:1px solid var(--border); padding:6px 10px; border-radius:8px; font-weight:600; color:var(--text-secondary); background:var(--panel); }
  .testimonials { margin: 24px 0; }
  .testimonials-grid { display:grid; grid-template-columns: repeat(auto-fit, minmax(240px,1fr)); gap: 12px; }
  .t-card { background: var(--panel); border:1px solid var(--border); border-radius:10px; padding:14px; }
  .t-card p { margin:0 0 8px; color: var(--text); }
  .t-card .who { color: var(--text-secondary); font-size: 0.85rem; }
  .whats-new-grid { display: grid; gap: 12px; }
  .cta-section { background: linear-gradient(135deg, rgba(124,92,255,0.1), rgba(0,209,178,0.1)); border: 1px solid rgba(124,92,255,0.2); border-radius: 16px; padding: 28px 16px; text-align: center; margin-top: 28px; }
  .cta-content h2 { margin: 0 0 8px; color: var(--text); }
  .cta-content p { color: var(--text-secondary); margin: 0 0 16px; }
  .cta-buttons { display:flex; gap:10px; justify-content:center; flex-wrap:wrap; }
  .btn-outline { background: transparent; border: 1px solid var(--accent); color: var(--accent); }
  .btn-outline:hover { background: rgba(124,92,255,0.1); }
  .fun-controls { margin-top: 6px; }

  /* Tagline rotator */
  .tagline { margin-top: 8px; color: var(--text-secondary); min-height: 20px; }
  .tagline.fade { animation: fadeIn 0.35s ease; }
  @keyframes fadeIn { from { opacity: 0; transform: translateY(3px); } to { opacity: 1; transform: translateY(0); } }
  
  /* Home ticker */
  .home-ticker { margin: 10px 0 18px; border-top:1px solid var(--border); border-bottom:1px solid var(--border); overflow:hidden; }
  .home-ticker-track { display:flex; gap: 18px; padding: 10px 0; animation: marquee 40s linear infinite; }
  .tick-item { display:flex; gap:8px; align-items:center; padding:4px 8px; border:1px solid var(--border); border-radius:999px; background: var(--panel); }
  .tick-item .sym { font-weight:700; color: var(--text); }
  .tick-item .val.up { color:#00d1b2; }
  .tick-item .val.down { color:#ff5c7c; }
  @keyframes marquee { 0%{ transform: translateX(0);} 100%{ transform: translateX(-50%);} }

  /* Weekly Battle */
  .weekly-battle { margin: 18px 0 24px; }
  .section-header.with-actions { display:flex; align-items:center; justify-content:space-between; gap: 12px; }
  .btn.loot { background: rgba(255, 214, 102, 0.15); border: 1px solid rgba(255, 214, 102, 0.4); color: #ffd166; }
  .btn.loot:hover { background: rgba(255, 214, 102, 0.25); }
  .wb-grid { display:grid; grid-template-columns: 1fr; gap: 12px; }
  .wb-match { display:grid; grid-template-columns: 1fr auto 1fr; gap: 10px; align-items: stretch; }
  .wb-vs { display:flex; align-items:center; justify-content:center; font-weight:800; color: var(--text-secondary); padding: 8px; }
  .wb-card { background: var(--panel); border:1px solid var(--border); border-radius:12px; padding:10px; display:flex; flex-direction:column; gap:8px; }
  .wb-head { display:flex; gap:8px; align-items:center; }
  .wb-head .sym { font-weight:800; color: var(--text); }
  .wb-head .name { color: var(--text-secondary); font-size: 0.9rem; }
  .wb-spark svg { width:100%; height:24px; }
  .wb-meta { color: var(--text-secondary); font-size: 0.85rem; }
  .wb-meta .up { color:#00d1b2; }
  .wb-meta .down { color:#ff5c7c; }
  .wb-ctrl { margin-top: 6px; }
  .wb-bars { display:grid; gap:6px; }
  .wb-bar { position: relative; background: rgba(255,255,255,0.05); border:1px solid var(--border); border-radius: 999px; height: 10px; overflow: hidden; }
  .wb-bar .fill { position:absolute; top:0; left:0; height:100%; background: linear-gradient(90deg, #7c5cff, #00d1b2); width: 0; transition: width 0.35s ease; }
  .wb-bar .pct { position:absolute; right: 6px; top:-18px; font-size: 0.75rem; color: var(--text-secondary); }
  .wb-actions { margin-top: 6px; display:flex; gap:8px; }
  .wb-actions .btn.small.active { outline: 2px solid var(--accent); }

  /* Spin */
  .spin-section { margin: 18px 0 24px; }
  .spin-result { margin-top: 10px; background: var(--panel); border:1px solid var(--border); border-radius: 12px; padding: 12px; }
  .spin-card { display:grid; grid-template-columns: 1fr auto; gap:10px; align-items:center; }
  .spin-sym { font-weight: 800; color: var(--text); }
  .spin-name { color: var(--text-secondary); }
  .spin-meta { font-size: 0.9rem; color: var(--text-secondary); }
  .spin-pct.up { color: #00d1b2; }
  .spin-pct.down { color: #ff5c7c; }

  /* Spotlights */
  .spotlights { margin: 24px 0; }
  .spotlights-grid { display:grid; grid-template-columns: 1fr 1fr; gap: 16px; }
  .spot-panel { background: var(--panel); border:1px solid var(--border); border-radius: 12px; padding: 14px; }
  .spot-cards { display:grid; gap:10px; }
  .spot-card { border:1px solid var(--border); border-radius:10px; padding:10px; background: var(--bg); transition: transform .15s ease, border-color .15s ease; }
  .spot-card:hover { transform: translateY(-1px); border-color: var(--accent); }
  .spot-title { font-weight: 700; color: var(--text); }
  .spot-meta { font-size: 0.8rem; color: var(--text-secondary); margin-top: 6px; }
  @media (max-width: 820px){ .spotlights-grid { grid-template-columns: 1fr; } }

  /* Daily Quest */
  .daily-quest { margin: 24px 0; }
  .dq-grid { display:grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 12px; }
  .dq-card { background: var(--panel); border:1px solid var(--border); border-radius:12px; padding:12px; display:flex; flex-direction:column; gap:8px; }
  .dq-card .title { font-weight: 700; color: var(--text); display:flex; align-items:center; gap:8px; }
  .dq-card .desc { color: var(--text-secondary); font-size: 0.9rem; }
  .dq-card .actions { display:flex; gap:8px; flex-wrap:wrap; }
  .dq-card.done { border-color: #00d1b2; box-shadow: 0 0 0 1px rgba(0,209,178,0.3) inset; }
  .streak-pill { margin-left: auto; background: rgba(255,255,255,0.06); border:1px solid var(--border); border-radius: 999px; padding: 6px 10px; font-weight: 700; color: var(--text); }

  /* Party mode */
  body.party .hero::before { animation: partyGlow 6s ease-in-out infinite; }
  @keyframes partyGlow { 0%,100%{ filter: hue-rotate(0deg) brightness(1);} 50%{ filter: hue-rotate(60deg) brightness(1.15);} }
  body.party .product-card.featured { box-shadow: 0 0 0 2px rgba(124,92,255,0.25), 0 0 20px rgba(124,92,255,0.25); }
</style>
{% endblock %}
